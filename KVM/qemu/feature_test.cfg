- feature_test:
    type = feature_test
    kill_vm_on_error = yes
    start_vm = yes
    vga = std
    pip_packages = python3 python3-pip
    test_dir = '/home'
    auto_cpu_model = "no"
    cpu_model = host
    variants:
        - arch_pebs:
            no tdvm
            feature_dir_names = "pmu"
            disable_parallel_run = yes
            pre_command = 'echo 0 > /proc/sys/kernel/nmi_watchdog && modprobe -r kvm_intel && modprobe kvm_intel enable_mediated_pmu=Y'
            post_command = 'echo 1 > /proc/sys/kernel/nmi_watchdog && modprobe -r kvm_intel && modprobe kvm_intel'
            test_scen = "tests_arch_pebs"
        - arch_perfmon_v6:
            no tdvm
            feature_dir_names = "pmu"
            disable_parallel_run = yes
            pre_command = 'echo 0 > /proc/sys/kernel/nmi_watchdog && modprobe -r kvm_intel && modprobe kvm_intel enable_mediated_pmu=Y'
            post_command = 'echo 1 > /proc/sys/kernel/nmi_watchdog && modprobe -r kvm_intel && modprobe kvm_intel'
            test_scen = "tests_arch_perfmon_v6"
        - 3_fix_counters:
            no tdvm
            feature_dir_names = "pmu"
            disable_parallel_run = yes
            pre_command = 'echo 0 > /proc/sys/kernel/nmi_watchdog && modprobe -r kvm_intel && modprobe kvm_intel enable_mediated_pmu=Y'
            post_command = 'echo 1 > /proc/sys/kernel/nmi_watchdog && modprobe -r kvm_intel && modprobe kvm_intel'
            test_scen = "tests_3fix_counters"
        - cmpccxadd:
            feature_dir_names = "cmpccxadd"
        - lam:
            feature_dir_names = "lam"
        - lass:
            feature_dir_names = "lass"
        - umip:
            feature_dir_names = "umip"
        - amx:
            feature_dir_names = "amx"
            cmd_timeout = 500
        - fred:
            feature_dir_names = "fred"
        - nmis:
            feature_dir_names = "nmis"
            no tdvm
    variants:
        - vm:
        - tdvm:
            machine_type_extra_params = "kernel-irqchip=split"
            vm_secure_guest_type = tdx
